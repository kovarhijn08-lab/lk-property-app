# Журнал проверок (Verification Log)

Этот файл содержит список действий для ручной проверки текущего состояния систем Skynet и устойчивости приложения.

## 1. Проверка Всевидящего ока (Global Logs)
- [ ] **Действие**: Выйдите из аккаунта и создайте нового тестового пользователя.
- [ ] **Ожидаемый результат**: В админ-панели (под админом) во вкладке **Global Logs** должна появиться запись `New user registered: [email]`.
- [ ] **Действие**: Под новым пользователем создайте проект (Property).
- [ ] **Ожидаемый результат**: В логах должна появиться запись `New property created: "[Name]"`.

## 2. Проверка системы восстановления (Undo/Restore)
- [ ] **Действие**: Удалите любой проект (Property).
- [ ] **Ожидаемый результат**: В логах (Global Logs) должна появиться запись `Delete snapshot for "[ID]"`.
- [ ] **Действие**: Нажмите на синюю кнопку **↺ RESTORE DATA** рядом с этой записью.
- [ ] **Ожидаемый результат**: Проект должен снова появиться в списке объектов (проверьте на главной странице или в списке объектов).

## 3. Проверка живого списка пользователей
- [ ] **Действие**: Откройте админку на вкладке **Users**. В другом окне или в режиме инкогнито зарегистрируйте нового пользователя.
- [ ] **Ожидаемый результат**: Новый пользователь должен появиться в списке в админке мгновенно, без перезагрузки страницы.

## 4. Проверка монитора задержек (Latency)
- [ ] **Действие**: Зайдите в админку на вкладку **Overview**.
- [ ] **Ожидаемый результат**: Вы должны видеть число задержки (например, `45ms`) и мини-график из 10 последних замеров.

## 5. Минимальные E2E Сценарии (P1.5)
- [ ] **E2E 1: Полный цикл входа**
  - **Действие**: Выход -> Вход под админом.
  - **Ожидаемый результат**: Редирект на Dashboard, отсутствие ошибок в консоли.
- [ ] **E2E 2: Создание и видимость**
  - **Действие**: Создать Property "P1.5 Test".
  - **Ожидаемый результат**: Объект появляется в списке мгновенно.
- [ ] **E2E 3: Финансы и Метрики**
  - **Действие**: Добавить транзакцию $1000 (Rent) в новый объект.
  - **Ожидаемый результат**: Cash Flow и Gross Revenue на Dashboard обновляются.
- [ ] **E2E 4: Безопасность Impersonation**
  - **Действие**: Ghost Mode -> Выбрать Tenant.
  - **Ожидаемый результат**: Видны только объекты этого Tenant. Доступ к Admin-панели заблокирован (скрыт).
- [ ] **E2E 5: Устойчивость сессии**
  - **Действие**: Обновить страницу (F5) во время Ghost Mode.
  - **Ожидаемый результат**: Ghost Mode сохраняется, данные не пропадают.

## 6. Проверка усиленной безопасности (Security Hardening)
- [ ] **E2E 6: Регистрация жильца без инвайта**
  - **Действие**: Перейти на `/signup`, выбрать роль Жилец (если доступно) или попытаться отправить форму регистрации жильца без токена инвайта (имитируя вызов API).
  - **Ожидаемый результат**: `AuthContext` должен выдать ошибку, пользователь не должен быть создан в Firestore.
- [ ] **E2E 7: Использование чужого инвайта**
  - **Действие**: Попытаться зарегистрироваться по инвайту, который уже был использован другим UID.
  - **Ожидаемый результат**: Firestore rules должны заблокировать создание документа пользователя, так как `usedBy` в инвайте не совпадает.
- [ ] **E2E 8: Доступ к объектам по UID (UID isolation)**
  - **Действие**: Под жильцом попытаться прочитать объект, где его UID нет в `tenantIds`, но Email совпадает с `tenantEmails`.
  - **Ожидаемый результат**: Отказ в доступе (Permission Denied), так как правила теперь требуют наличия UID в `tenantIds`.
- [ ] **E2E 9: Скрытые инвайты**
  - **Действие**: Попытаться прочитать коллекцию `invitations` полностью под обычным жильцом.
  - **Ожидаемый результат**: Ошибка доступа. Разрешено только PMC и Owner.

## 7. Tenant Portal (Unified)
- [ ] **TP 1: Единый портал**
  - **Действие**: Войти как Tenant и открыть портал.
  - **Ожидаемый результат**: Видны вкладки Dashboard / Fix / Chat / Docs, нет панелей Admin/Owner.
- [ ] **TP 2: Messaging**
  - **Действие**: Отправить сообщение и файл (изображение или PDF).
  - **Ожидаемый результат**: Отображаются вложения, есть индикатор read/typing.
- [ ] **TP 3: Maintenance**
  - **Действие**: Создать заявку на ремонт и проверить timeline статусов.
  - **Ожидаемый результат**: Заявка создается и отображается в списке с timeline.
- [ ] **TP 4: Documents**
  - **Действие**: Открыть Documents.
  - **Ожидаемый результат**: Доступны только документы жильца, видна кнопка View/Download.
- [ ] **TP 5: Profile & Notifications**
  - **Действие**: Открыть Profile, изменить телефон и переключить уведомления.
  - **Ожидаемый результат**: Настройки сохраняются (после перезагрузки остаются).

## 8. Global Error Logging (Skynet)
- [ ] **GE 1: window.onerror**
  - **Действие**: В консоли выполнить `setTimeout(() => { throw new Error('Skynet global error test') }, 0)`.
  - **Ожидаемый результат**: В `system_logs` появляется запись с action `global.error`.
- [ ] **GE 2: unhandledrejection**
  - **Действие**: В консоли выполнить `Promise.reject(new Error('Skynet rejection test'))`.
  - **Ожидаемый результат**: В `system_logs` появляется запись с action `global.unhandledrejection`.

## 9. Skynet Dedupe & Version
- [ ] **DV 1: App Version**
  - **Действие**: Открыть Admin Console → Overview.
  - **Ожидаемый результат**: Отображается поле `App Version`.
- [ ] **DV 2: Suppressed Count**
  - **Действие**: В консоли несколько раз подряд вызвать одну и ту же ошибку (5+ раз).
  - **Ожидаемый результат**: В `system_logs` в `metadata.suppressedCount` увеличивается значение.

## 10. Admin & Tenant Polish
- [ ] **AP 1: Logs Export**
  - **Действие**: Admin Console → Logs → нажать `Export JSON`.
  - **Ожидаемый результат**: скачивается `logs.json`.
- [ ] **AP 2: Incidents Export**
  - **Действие**: Admin Console → Incidents → нажать `Export JSON`.
  - **Ожидаемый результат**: скачивается `incidents.json`.
- [ ] **TP 6: Quick Actions Navigation**
  - **Действие**: Tenant Dashboard → клик по карточкам Quick Actions.
  - **Ожидаемый результат**: переходы на Chat / Maintenance / Docs.

## 11. Admin Users UX
- [ ] **AU 1: Search & Role Filter**
  - **Действие**: Admin Console → Users → ввести search + выбрать роль.
  - **Ожидаемый результат**: список фильтруется, отображается счётчик `filtered/total`.
- [ ] **AU 2: Users Export**
  - **Действие**: Admin Console → Users → нажать `Export JSON`.
  - **Ожидаемый результат**: скачивается `users.json`.

---
*Если что-то не работает, проверьте, были ли деплойнуты правила Firestore: `firebase deploy --only firestore:rules`*
